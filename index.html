<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã‚«ãƒ¼ãƒˆUIï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼‰ v3</title>
  <style>
    :root{
      --panel:#d9d39a;
      --ink:#1a1a1a;
      --shadow: 0 10px 30px rgba(0,0,0,.18);
      --radius: 28px;

      /* shop colors */
      --amz1:#f1b35d; --amz2:#e7a54a;
      --rkt1:#f0a2a6; --rkt2:#e6868f;
      --yah1:#b2a7f5; --yah2:#8f84df;
      --oth1:#bdbdbd; --oth2:#a8a8a8;

      --empty:#bdbdbd;
      --chip:#ffffff66;
      --danger:#f04c4c;
      --dark:#111;

      /* left UI */
      --cardbg:#ffffff;
      --stroke: rgba(0,0,0,.08);
      --softshadow: 0 8px 24px rgba(0,0,0,.08);
      --muted:#6b7280;

      /* heights */
      --topRowH: 420px;
      --demandCardH: 360px;
      --lowerGap: 14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      color:var(--ink);
      background:#f3f3f3;
      display:flex;
      justify-content:center;
      padding:24px;
    }

    .stage{
      width: min(1560px, 100%);
      display:grid;
      grid-template-columns: minmax(820px, 1fr) 360px;
      gap:18px;
      align-items:start;
    }

    /* ===== Left ===== */
    .mock{ border-radius:18px; background:transparent; position:relative; overflow:visible; min-height:680px; }

    .card-ui{
      background: var(--cardbg);
      border-radius: 18px;
      box-shadow: var(--softshadow);
      border: 1px solid var(--stroke);
      padding: 14px;
      overflow:hidden;
    }
    .card-ui h4{ margin:0 0 10px; font-size:15px; font-weight:1000; letter-spacing:.02em; }
    .subtle{ color:var(--muted); font-size:10px; font-weight:900; }

    .top-row{
      display:grid;
      grid-template-columns: 1.05fr 1.05fr 1.55fr;
      gap:14px;
      align-items:stretch;
      grid-auto-rows: var(--topRowH);
    }
    .top-row .card-ui{
      height: var(--topRowH);
      display:flex;
      flex-direction:column;
    }

    .product-image{ display:flex; flex-direction:column; gap:12px; flex:1; min-height:0; }
    .img-frame{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.08);
      background:#f6f7f9;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      padding:12px;
      flex:1;
      min-height:0;
    }
    .img-frame img{ width:100%; height:100%; object-fit:contain; display:block; }

    .info-list{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap:10px 14px;
      font-size:12px;
      font-weight:900;
      line-height:1.35;
    }
    .info-list .k{ color:var(--muted); font-weight:1000; letter-spacing:.02em; }
    .info-list .v{ font-weight:1000; min-width:0; word-break:break-word; }
    .stars{ letter-spacing:.06em; color:#111; }
    .badge-row{ display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; }
    .badge{
      font-size:10px; font-weight:1000;
      padding:5px 8px; border-radius:999px;
      border:1px solid rgba(0,0,0,.08);
      background:#f8fafc; white-space:nowrap;
    }
    .badge.red{ color:#b91c1c; background:#fee2e2; border-color: rgba(185,28,28,.18); }
    .badge.blue{ color:#1d4ed8; background:#dbeafe; border-color: rgba(29,78,216,.18); }
    .badge.orange{ color:#9a3412; background:#ffedd5; border-color: rgba(154,52,18,.18); }

    .card-ui.scrollable .scroll-area{ overflow:auto; padding-right:6px; flex:1; min-height:0; }

    /* ===== ä¸»è¦é …ç›® ===== */
    .metrics-card{ padding:10px; }
    .metrics-card h4{ margin:0 0 8px; font-size:14px; }


    /* ä¸»è¦é …ç›®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šå±é™ºå€¤æŒ‡æ¨™ï¼ˆ3ã¤ã®ä¸¸ã‚²ãƒ¼ã‚¸ï¼‰ */
    .metrics-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
    }
    .metrics-head h4{ margin:0; }
    .danger-gauges{ display:flex; gap:10px; align-items:flex-end; }
    .gauge-wrap{ display:flex; flex-direction:column; align-items:center; gap:4px; }
    .gauge-label{ font-size:9px; font-weight:1000; color:var(--muted); white-space:nowrap; }

    .gauge{
      --p: 60;
      width:54px; height:54px;
      border-radius:50%;
      position:relative;
      display:grid;
      place-items:center;
      background: conic-gradient(#f59e0b calc(var(--p)*1%), #e5e7eb 0);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .gauge[data-state='stable']{
      background: conic-gradient(#22c55e calc(var(--p)*1%), #e5e7eb 0);
    }
    .gauge[data-state='warn']{
      background: conic-gradient(#f59e0b calc(var(--p)*1%), #e5e7eb 0);
    }
    .gauge[data-state='danger']{
      background: conic-gradient(#ef4444 calc(var(--p)*1%), #e5e7eb 0);
    }
    .gauge::before{
      content:'';
      position:absolute;
      inset:6px;
      border-radius:50%;
      background:#fff;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .gauge-inner{
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      line-height:1;
    }
    .gauge-inner .num{
      font-size:14px;
      font-weight:1000;
      letter-spacing:.02em;
    }
    .gauge-inner .state{
      margin-top:2px;
      font-size:9px;
      font-weight:1000;
      color:var(--muted);
      white-space:nowrap;
    }


    .metric-grid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:6px;
      margin-top: 6px;
    }
    .metric{
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 14px;
      padding: 8px;
      background: #fff;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
      min-height: 58px;
    }
    .metric .label{ font-size:9px; color:var(--muted); font-weight:1000; }
    .metric .value{ margin-top:2px; font-size:15px; font-weight:1000; }

    .inputs-grid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:6px;
      margin-top: 6px;
    }
    .m-input{
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 14px;
      background:#fff;
      padding: 8px 10px;
      min-height: 58px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:5px;
      overflow:hidden; /* â†å…ƒã®ã¾ã¾OKï¼ˆä¸‹ã§äºˆæ¸¬æ ã ã‘ä¸Šæ›¸ãï¼‰ */
    }
    .m-input .label{ font-size:9px; color:var(--muted); font-weight:1000; line-height:1.15; }

    /* äºˆæ¸¬ã‚«ãƒ¼ãƒ‰ï¼šã‚¿ã‚¤ãƒˆãƒ«å³ã«æ—¥æ•°å…¥åŠ›ã‚’é…ç½® */
    .predhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .days-inline{
      display:inline-flex;
      align-items:center;
      gap:4px;
      flex:0 0 auto;
    }
    .days-inline input{
      width:34px;
      text-align:right;
      padding:3px 5px;
      border:1px solid rgba(0,0,0,.10);
      border-radius:8px;
      font-weight:1000;
      outline:none;
      background:#fff;
      color:#111;
    }
    .days-inline .u{
      font-size:10px;
      font-weight:1000;
      color:var(--muted);
      white-space:nowrap;
    }

    .m-input input{
      width:100%;
      border:1px solid rgba(0,0,0,.10);
      border-radius:10px;
      padding:8px 10px;
      font-weight:1000;
      outline:none;
      background:#fff;
      text-align:left;
      color:#111;
    }
    .m-input input[readonly]{ background:#f8fafc; cursor:not-allowed; pointer-events:none; }

    /* äºˆæ¸¬ã€‡æ—¥ï¼šå…¥åŠ›ã¨è‡ªå‹•åæ˜ ï¼ˆåŒã˜æ å†…ï¼‰ */
    .predbox{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      width:100%;
    }
    .predbox .days{
      display:flex;
      align-items:center;
      gap:6px;
      flex:0 0 auto;
    }
    /* å…¥åŠ›æ¬„ã‚’å°ã•ã */
    .predbox .days input{
      width:44px;
      text-align:right;
      padding:6px 8px;
      border-radius: 10px;
    }
    .predbox .days .u{
      font-size:10px;
      font-weight:1000;
      color:var(--muted);
      white-space:nowrap;
    }
    /* è‡ªå‹•åæ˜ æ•°å­— */
    .predbox .val{
      flex:0 0 auto;
      min-width: 64px;
      text-align:right;
      font-size:16px;
      font-weight:1000;
      white-space:nowrap;
    }

    /* ===== è¡Œã”ã¨èƒŒæ™¯ï¼ˆä¸Šï¼šæ¿ƒã„ â†’ ä¸‹ï¼šè–„ã„ï¼‰ ===== */
    .metrics-row.row1 .metric,
    .metrics-row.row1 .m-input{ background: rgba(147,197,253,.70); }
    .metrics-row.row2 .metric,
    .metrics-row.row2 .m-input{ background: rgba(191,219,254,.62); }
    .metrics-row.row3 .metric,
    .metrics-row.row3 .m-input{ background: rgba(219,234,254,.55); }

    .metrics-row .metric, .metrics-row .m-input{
      border-color: rgba(0,0,0,.07);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.20);
    }

    .bottom-pills{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px;
    }
    .pillbox{
      border-radius:14px;
      border:1px solid rgba(0,0,0,.08);
      background:#f5f7ff;
      padding:12px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-weight:1000;
      gap:8px;
    }
    .pillbox .l{ font-size:10px; color:var(--muted); font-weight:1000; }
    .pillbox .r{ font-size:16px; font-weight:1000; white-space:nowrap; }
    .metrics-card .bottom-pills{ margin-top:auto; }

    /* ===== Lower row ===== */
    .lower{
      margin-top: var(--lowerGap);
      display:grid;
      grid-template-columns: 1fr 2fr;
      gap:14px;
      align-items:start;
    }
    .placeholder{
      border-radius:14px;
      border:1px dashed rgba(0,0,0,.18);
      background:#f6f7f9;
      min-height:260px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#9aa0a6;
      font-weight:1000;
      user-select:none;
      text-align:center;
      padding:12px;
    }

    .card-ui.demand-card{
      height: var(--demandCardH);
      display:flex;
      flex-direction:column;
    }
    .card-ui.demand-card .chart-wrap{
      flex:1;
      min-height:0;
      display:flex;
      flex-direction:column;
    }
    .card-ui.demand-card .fake-graph{
      flex:1;
      min-height:0;
      height:auto;
    }

    .chart-wrap{
      border-radius:14px;
      border:1px solid rgba(0,0,0,.08);
      background:#fff;
      padding:12px;
      overflow:hidden;
    }
    .chart-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px; }
    .chart-head .title{ font-weight:1000; }
    .toggles{ display:flex; gap:8px; align-items:center; color:var(--muted); font-size:10px; font-weight:1000; }
    .toggles label{
      display:flex; gap:6px; align-items:center; cursor:pointer; user-select:none;
      white-space:nowrap; /* â†èª¤å­—ä¿®æ­£ï¼ˆwhite-spaceÃ­vel; ã‚’æ’é™¤ï¼‰ */
    }
    .fake-graph{
      height:260px;
      border-radius:10px;
      background:
        linear-gradient(to right, rgba(0,0,0,.05) 1px, transparent 1px) 0 0/32px 32px,
        linear-gradient(to bottom, rgba(0,0,0,.05) 1px, transparent 1px) 0 0/32px 32px,
        linear-gradient(180deg, #f8fafc, #ffffff);
      border:1px solid rgba(0,0,0,.06);
      position:relative;
      overflow:hidden;
    }
    .fake-line{ position:absolute; inset:0; }
    .fake-line::before{
      content:""; position:absolute; left:-10%; top:52%;
      width:120%; height:2px; background: rgba(59,130,246,.9);
      transform: rotate(-12deg); filter: blur(.1px);
    }
    .fake-line::after{
      content:""; position:absolute; left:-10%; top:68%;
      width:120%; height:2px; background: rgba(245,158,11,.9);
      transform: rotate(-6deg); filter: blur(.1px);
    }
    .legend{ margin-top:10px; display:flex; gap:12px; flex-wrap:wrap; font-size:10px; font-weight:1000; color:var(--muted); }
    .dot{ width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:6px; }

    /* ===== Rightï¼ˆå›ºå®šã‚µã‚¤ã‚ºï¼‰ ===== */
    .side{
      background: var(--panel);
      border-radius: var(--radius);
      padding: 12px 14px 10px;
      box-shadow: var(--shadow);
      position:sticky;
      top:16px;

      height: calc(var(--topRowH) + var(--demandCardH) + var(--lowerGap));
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    .side-body{
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:0;
      flex:1;
      overflow:hidden;
    }

    .top3-wrap{
      margin-top: 0;
      padding: 8px;
      border-radius: 18px;
      background: rgba(255,255,255,.35);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      flex:0 0 auto;
    }
    .top3-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom: 8px;
    }
    .top3-title{
      font-weight:1000;
      letter-spacing:.02em;
      font-size:12px;
      opacity:.92;
      line-height:1.2;
    }
    .morebtn{
      border:0;
      background: rgba(0,0,0,.10);
      color:#111;
      font-weight:1000;
      padding: 9px 10px;
      border-radius: 999px;
      cursor:pointer;
      white-space:nowrap;
      font-size:10px;
    }
    .morebtn:disabled{ cursor:not-allowed; opacity:.55; }
    

    /* === Top3: move button under list + manual input === */
    .morebtn-wide{ width:100%; margin-top:8px; justify-content:center; }

    .manual-wrap{ margin-top:10px; }
    .manual-title{ font-weight:1000; font-size:11px; opacity:.92; margin: 0 2px 6px; }
    .manual-row{ background: rgba(255,255,255,.35); }

    .manual-price{
      display:flex;
      align-items:center;
      gap:6px;
      min-width: 120px;
      justify-content:flex-end;
    }
    .manual-price .yenmark{ font-weight:1000; opacity:.9; }
    .manual-price input{
      width: 82px;
      height: 28px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.75);
      font-weight:1000;
      text-align:right;
      outline:none;
    }
.top3-list{ display:flex; flex-direction:column; gap:8px; }

    .row{
      border-radius: 999px;
      padding: 8px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.18);
      font-weight:900;
      gap:5px;
      overflow:hidden;
    }
    .row .left{
      display:flex;
      align-items:center;
      gap:8px;
      min-width: 110px;
      overflow:hidden;
      flex: 1 1 auto;
    }
    .rank{
      width:26px;height:26px;
      border-radius:999px;
      display:grid; place-items:center;
      background: rgba(0,0,0,.14);
      font-weight:1000;
      color:#111;
      flex:0 0 auto;
      font-size:12px;
    }
    .shopname{
      font-weight:1000;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 110px;
      font-size:14px;
    }
    .row .price{
      min-width: 74px;
      font-size:15px;
      white-space:nowrap;
      flex:0 0 auto;
    }
    .row .right{
      display:flex;
      align-items:center;
      gap:6px;
      margin-left:auto;
      flex: 0 0 auto;
      max-width: 116px;
    }

    /* qty stepperï¼ˆã¯ã¿å‡ºã—é˜²æ­¢ï¼‰ */
    .stepper{
      display:flex;
      align-items:center;
      gap:5px;
      background: var(--chip);
      padding: 4px 6px;
      border-radius: 999px;
      width: 104px;
      min-width: 104px;
      max-width: 104px;
      justify-content:space-between;
      flex: 0 0 auto;
      overflow:hidden;
    }
    .stepper .label{
      font-weight:1000;
      opacity:.92;
      white-space:nowrap;
      font-size:10.5px;
      letter-spacing:.01em;
      flex:0 0 auto;
    }
    .stepper .controls{
      display:flex;
      align-items:center;
      gap:5px;
      flex:0 0 auto;
    }
    .stepper .qbtn{
      width:20px;height:20px;
      border-radius:999px;
      border:0;
      cursor:pointer;
      background: rgba(0,0,0,.12);
      font-weight:1000;
      line-height:1;
      flex:0 0 auto;
      font-size:10px;
    }
    .stepper .qval{
      min-width: 16px;
      text-align:center;
      font-weight:1000;
      font-size:11.5px;
      flex:0 0 auto;
    }

    .row.dim{ background: var(--empty); opacity:.78; box-shadow:none; }

    .shop-amazon { background: linear-gradient(180deg,var(--amz1),var(--amz2)); }
    .shop-rakuten{ background: linear-gradient(180deg,var(--rkt1),var(--rkt2)); }
    .shop-yahoo  { background: linear-gradient(180deg,var(--yah1),var(--yah2)); }
    .shop-other  { background: linear-gradient(180deg,var(--oth1),var(--oth2)); }

    .hinttxt{ font-size:10px; font-weight:900; opacity:.75; line-height:1.35; }

    /* ASINé›†è¨ˆ */
    .summary-box{
      margin: 0 6px;
      padding: 8px;
      border-radius: 18px;
      background: rgba(255,255,255,.35);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      flex:0 0 auto;
    }
    .summary-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 8px;
      gap:8px;
    }
    .summary-title{
      font-weight:1000;
      letter-spacing:.02em;
      font-size:12px;
      opacity:.92;
    }
    .summary-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:6px;
    }
    .sum-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding: 8px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.55);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      font-weight:1000;
      font-size:12px;
    }
    .sum-row .k{ color: rgba(0,0,0,.70); font-weight:1000; }
    .sum-row .v{ font-weight:1000; white-space:nowrap; }

    .dash{ border-top: 2px dashed rgba(0,0,0,.35); margin: 10px 6px 10px; flex:0 0 auto; }

    .actions{ display:flex; gap:8px; justify-content:center; padding: 4px 6px 2px; flex:0 0 auto; }
    .btn{
      border:0;
      border-radius: 999px;
      padding: 8px 10px;
      font-weight:1000;
      cursor:pointer;
      background: rgba(255,255,255,.6);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
      width: 50%;
      font-size:12px;
    }
    .btn.primary{ background: rgba(255,255,255,.85); }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .overlay.open{display:flex;}
    .modal{
      width:min(720px, 100%);
      background: var(--panel);
      border-radius: 26px;
      box-shadow: var(--shadow);
      padding: 18px;
      position:relative;
    }
    .close{
      position:absolute;
      right:14px; top:14px;
      width:34px; height:34px;
      border-radius:999px;
      border:0;
      background: var(--danger);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.25);
    }
    .modal h3{
      margin: 4px 8px 12px;
      font-size:16px;
      font-weight:1000;
      letter-spacing:.02em;
      opacity:.95;
    }
    .modal-list{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top: 6px;
      max-height: 62vh;
      overflow:auto;
      padding-right: 4px;
    }
    .card{
      border-radius: 22px;
      padding: 14px 14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.18);
    }
    .card-head{
      display:flex; justify-content:space-between; align-items:flex-start;
      gap:12px;
      font-weight:1000;
    }
    .meta{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px 12px;
      align-items:center;
    }
    .pill{
      display:flex; justify-content:space-between; align-items:center;
      padding: 8px 10px;
      background: rgba(255,255,255,.35);
      border-radius: 14px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      font-weight:1000;
      gap:8px;
    }
    .okwrap{ display:flex; justify-content:center; margin: 16px 0 8px; }
    .ok{
      border:0;
      width:min(420px, 100%);
      border-radius: 999px;
      padding: 14px 16px;
      background:#ff2f2f;
      color:#fff;
      font-weight:1000;
      font-size:18px;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(255,47,47,.25), inset 0 0 0 2px rgba(255,255,255,.15);
    }

    /* =========================
       â˜… ã“ã“ãŒä»Šå›ã®ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ
       å³å´ã®æ•°å€¤ãŒåˆ‡ã‚Œãªã„ã‚ˆã†ã«èª¿æ•´
       ========================= */
    .predbox{ min-width:0; }
    .predbox .days{ flex:0 0 auto; }
    .predbox .val{
      flex:1 1 auto;
      min-width:0;
      text-align:right;
      padding-left:10px;
      font-size: clamp(14px, 1.4vw, 16px);
      line-height:1.1;
      white-space:nowrap;
    }
    /* ã“ã®æ ã ã‘ã¯åˆ‡ã‚Šè½ã¨ã•ãªã„ï¼ˆm-inputã®overflow:hiddenå¯¾ç­–ï¼‰ */
    .m-input .predbox{ overflow:visible; }


    /* =========================
       â˜… v10: ä¸»è¦é …ç›®ã®æ•´ç† & äºˆæ¸¬æ—¥æ•°å…¥åŠ›ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ–
       - äºˆæ¸¬ã€‡æ—¥è²©å£²æ•°ï¼šãƒ©ãƒ™ãƒ«ï¼‹å…¥åŠ›ã‚’æ¨ªä¸¦ã³ã§1è¡Œã«
       - æ—¥æ•°å…¥åŠ›æ¬„ã‚’å°ã•ã
       - ä¸»è¦é …ç›®ã®ä½™ç™½/è¡Œé–“ã‚’å°‘ã—ç· ã‚ã¦è¦‹ã‚„ã™ã
       ========================= */
    .predhead{
      justify-content:flex-start; /* space-between â†’ å·¦å¯„ã› */
      gap:8px;
    }
    .predhead .label{
      white-space:nowrap;
      font-size:10px;
      font-weight:1000;
      color:var(--muted);
    }
    .days-inline input{
      width:36px;     /* å°ã•ã */
      height:26px;
      padding:2px 4px;
      font-size:12px;
      border-radius:6px;
    }

    /* ä¸»è¦é …ç›®ã‚’å°‘ã—ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
    .metrics-card{ padding:10px; }
    .m-input{
      padding:8px 10px;
      min-height:auto;
      gap:6px;
    }
    .variants{ gap:4px; margin-top:6px; }
    .vrow{ padding:4px 6px; }


    /* ===== äºˆæ¸¬è²©å£²æ•°ï¼š3ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤ºï¼ˆãƒªã‚¹ã‚¯/åˆ©ç›Š/æ”»ã‚ï¼‰ ===== */
    .scenario-bar{
      display:flex;
      gap:6px;
      align-items:center;
      margin: 4px 0 6px;
      flex-wrap:wrap;
    }
    .scenario-bar .hint{
      font-size:10px;
      font-weight:1000;
      color:var(--muted);
      margin-right:4px;
      white-space:nowrap;
    }
    .scenario-opt{
      position:relative;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 8px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
      cursor:pointer;
      user-select:none;
      font-weight:1000;
      font-size:10px;
      line-height:1;
    
      opacity:.35;
      filter:saturate(.85);
    }
    .scenario-opt input{ position:absolute; inset:0; opacity:0; cursor:pointer; }
    
    .scenario-opt .box{
      width:18px; height:18px;
      border-radius:4px;
      border:1.8px solid rgba(0,0,0,.28);
      background: rgba(255,255,255,.85);
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }
    .scenario-opt .box::after{
      content:"";
      font-size:12px;
      font-weight:1000;
      line-height:1;
      transform: translateY(-0.5px);
      color:#111;
    }
    .scenario-opt[data-active="true"] .box::after{
      content:"âœ“";
    }
.scenario-opt[data-active="true"]{
      background: rgba(255,255,255,.92);
      border-color: rgba(0,0,0,.14);
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
    
      opacity:1;
      filter:none;
      box-shadow: 0 10px 22px rgba(0,0,0,.12);
    }
    .scenario-opt[data-active="true"] .box{
      border-color: rgba(0,0,0,.30);
      background:#fff;
    
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.08);
    }

    .variants{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin-top:4px;
    }
    .vrow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:4px 8px;
      border-radius:10px;
      background: rgba(255,255,255,.35);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
      overflow:hidden;
    }
    .vrow .k{
      font-size:9px;
      font-weight:1000;
      color: rgba(0,0,0,.70);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .vrow .v{
      font-size:11px;
      font-weight:1000;
      white-space:nowrap;
      flex:0 0 auto;
    }
    .vrow[data-active="true"]{
      background: rgba(255,255,255,.75);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.10), 0 6px 14px rgba(0,0,0,.08);
    }
     .vrow[data-active="true"] .v{
      font-size:14px;
    }


    /* vrow emphasis override */
    .vrow{
      opacity:.28;
      background: rgba(255,255,255,.16);
    }
    .vrow[data-active="false"]{
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
    }
    .vrow[data-active="false"] .k,
    .vrow[data-active="false"] .v{
      color: rgba(0,0,0,.52);
    }
    .vrow[data-active="true"]{
      opacity:1;
      background: rgba(255,255,255,.88);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.14), 0 12px 26px rgba(0,0,0,.14);
    }
    .vrow[data-active="true"] .k{ color: rgba(0,0,0,.85); }
    .vrow[data-active="true"] .v{ color:#111; }


    @media (max-width: 1180px){
      .stage{ grid-template-columns: 1fr; }
      .side{ position:relative; top:auto; height:auto; overflow:visible; }
      .side-body{ overflow:visible; }
      .cart-box{ min-height:auto; }
      .cart-scroll{ overflow:visible; }
    }
    @media (max-width: 1080px){
      :root{ --topRowH: auto; --demandCardH: auto; }
      .top-row{ grid-template-columns: 1fr; grid-auto-rows: auto; }
      .top-row .card-ui{ height:auto; }
      .lower{ grid-template-columns: 1fr; }
      .metric-grid, .inputs-grid{ grid-template-columns: 1fr; }
      .card-ui.demand-card{ height:auto; }
    }
    @media (max-width: 900px){
      body{padding:14px}
    }
  
/* === Compact metrics layout v11 === */
.metrics-head{ margin-bottom:4px; }
.metrics-row{ margin-top:4px; }

.inputs-grid,
.metric-grid{
  gap:6px;
}

.m-input,
.metric{
  padding:6px 8px;
  min-height:48px;
}

.m-input .label,
.metric .label{
  font-size:9px;
}

.metric .value{
  font-size:14px;
  margin-top:2px;
}

/* variants rows tighter */
.variants{ gap:2px; margin-top:4px; }
.vrow{ padding:3px 6px; }
.vrow .k{ font-size:9px; }
.vrow .v{ font-size:12px; }

/* bottom pills compact */
.bottom-pills{ margin-top:8px; gap:6px; }
.pillbox{ padding:8px 10px; }
.pillbox .r{ font-size:14px; }

</style>
</head>
<body>
  <div class="stage">

    <!-- LEFT -->
    <main class="mock" aria-label="å•†å“ãƒšãƒ¼ã‚¸ãƒ¢ãƒƒã‚¯">
      <div class="top-row">

        <!-- å•†å“ç”»åƒ -->
        <section class="card-ui image-card">
          <h4>å•†å“ç”»åƒ</h4>
          <div class="product-image">
            <div class="img-frame" aria-label="å•†å“ç”»åƒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼">
              <img alt="å•†å“ç”»åƒ" src="https://dummyimage.com/800x520/e5e7eb/9ca3af.png&text=Product+Image" />
            </div>
          </div>
        </section>

        <!-- å•†å“æƒ…å ± -->
        <section class="card-ui scrollable">
          <h4>å•†å“æƒ…å ±</h4>
          <div class="scroll-area">
            <div class="info-list">
              <div class="k">æ³¨æ„äº‹é …</div>
              <div class="v">
                <div class="badge-row">
                  <span class="badge red">è¼¸å‡ºä¸å¯</span>
                  <span class="badge blue">çŸ¥è²¡</span>
                  <span class="badge orange">å¤§å‹</span>
                </div>
              </div>

              <div class="k">å•†å“å</div><div class="v">ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ’ãƒ¼ãƒ­ãƒ¼ 5ä½“ã‚»ãƒƒãƒˆ</div>
              <div class="k">ãƒ–ãƒ©ãƒ³ãƒ‰</div><div class="v">HeroWorks</div>
              <div class="k">è©•ä¾¡</div><div class="v"><span class="stars">â˜…â˜…â˜…â˜…â˜†</span> <span class="subtle">(523)</span></div>
              <div class="k">å„ç¨®ASIN</div><div class="v">æ—¥æœ¬ï¼šB0J0000001 / USï¼šB0A0000001</div>
              <div class="k">JAN</div><div class="v">4900000000001</div>
              <div class="k">SKU</div><div class="v">HW-HERO-SET-5</div>
              <div class="k">ã‚µã‚¤ã‚º</div><div class="v">32Ã—26Ã—8</div>
              <div class="k">é‡é‡ï¼ˆå®Ÿç©é‡é‡ï¼‰</div><div class="v">1.10kgï¼ˆ1.20kgï¼‰</div>
              <div class="k">ã‚«ãƒ†ã‚´ãƒª</div><div class="v">Toys &amp; Games / Action Figures</div>
              <div class="k">æè³ª</div><div class="v">ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ / ç´™</div>
              <div class="k">å‚™è€ƒ</div><div class="v">é•·ããªã£ã¦ã‚‚ã‚«ãƒ¼ãƒ‰å†…ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¦‹ã‚‰ã‚Œã¾ã™ã€‚</div>
            </div>
          </div>
        </section>

        <!-- ä¸»è¦é …ç›® -->
        <section class="card-ui metrics-card">
          <div class="metrics-head">
            <h4>ä¸»è¦é …ç›®</h4>
            <div class="danger-gauges" aria-label="å±é™ºå€¤æŒ‡æ¨™">
              <div class="gauge-wrap">
                <div class="gauge" id="g_recent" data-state="warn" style="--p:62">
                  <div class="gauge-inner">
                    <div class="num" id="g_recent_num">62</div>
                    <div class="state" id="g_recent_state">æ³¨æ„</div>
                  </div>
                </div>
                <div class="gauge-label">ç›´è¿‘é‡è¦–</div>
              </div>
              <div class="gauge-wrap">
                <div class="gauge" id="g_count" data-state="stable" style="--p:38">
                  <div class="gauge-inner">
                    <div class="num" id="g_count_num">38</div>
                    <div class="state" id="g_count_state">å®‰å®š</div>
                  </div>
                </div>
                <div class="gauge-label">å›æ•°é‡è¦–</div>
              </div>
              <div class="gauge-wrap">
                <div class="gauge" id="g_both" data-state="warn" style="--p:54">
                  <div class="gauge-inner">
                    <div class="num" id="g_both_num">54</div>
                    <div class="state" id="g_both_state">æ³¨æ„</div>
                  </div>
                </div>
                <div class="gauge-label">ä¸¡æ–¹</div>
              </div>
            </div>
          </div>

          <!-- 1è¡Œç›®ï¼ˆäºˆæ¸¬ï¼šã‚·ãƒŠãƒªã‚ªè¡¨ç¤ºï¼‰ -->
          <div class="metrics-row row1">

            <!-- ã‚·ãƒŠãƒªã‚ªé¸æŠï¼ˆãƒã‚§ãƒƒã‚¯ã—ãŸã‚‚ã®ãŒç›®ç«‹ã¤ï¼‰ -->
            <div class="scenario-bar" aria-label="äºˆæ¸¬ã‚·ãƒŠãƒªã‚ªé¸æŠ">
              <div class="hint">è¡¨ç¤ºï¼š</div>

              <label class="scenario-opt" id="opt-risk" data-active="false">
                <span class="box" aria-hidden="true"></span>
                <input type="radio" name="scenario" value="risk" />
                <span>ãƒªã‚¹ã‚¯é‡è¦–ğŸ€</span>
              </label>

              <label class="scenario-opt" id="opt-profit" data-active="true">
                <span class="box" aria-hidden="true"></span>
                <input type="radio" name="scenario" value="profit" checked />
                <span>åˆ©ç›Šãƒ™ãƒ¼ã‚¹âœ¨</span>
              </label>

              <label class="scenario-opt" id="opt-attack" data-active="false">
                <span class="box" aria-hidden="true"></span>
                <input type="radio" name="scenario" value="attack" />
                <span>æ”»ã‚ğŸ”¥</span>
              </label>
            </div>

            <div class="inputs-grid" style="margin-top:6px;">
              <!-- äºˆæ¸¬ã€‡æ—¥ï¼ˆå…¥åŠ› + 3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ -->
              <div class="m-input">
                <div class="predhead">
                  <div class="label">äºˆæ¸¬ã€‡æ—¥è²©å£²æ•°</div>
                  <div class="days-inline" aria-label="äºˆæ¸¬æ—¥æ•°å…¥åŠ›">
                    <input id="predDays" inputmode="numeric" value="180" aria-label="äºˆæ¸¬æ—¥æ•°" />
                    <span class="u">æ—¥</span>
                  </div>
                </div>
                <div class="variants" aria-label="äºˆæ¸¬ã€‡æ—¥è²©å£²æ•°ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰">
                  <div class="vrow" data-scn="risk" data-active="false"><div class="k">ãƒªã‚¹ã‚¯é‡è¦–ğŸ€</div><div class="v" id="predVarRisk">â€”</div></div>
                  <div class="vrow" data-scn="profit" data-active="true"><div class="k">åˆ©ç›Šãƒ™ãƒ¼ã‚¹âœ¨</div><div class="v" id="predVarProfit">â€”</div></div>
                  <div class="vrow" data-scn="attack" data-active="false"><div class="k">æ”»ã‚ğŸ”¥</div><div class="v" id="predVarAttack">â€”</div></div>
                </div>
              </div>

              <!-- äºˆæ¸¬90æ—¥ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ -->
              <div class="m-input">
                <div class="label">äºˆæ¸¬90æ—¥è²©å£²æ•°</div>
                <div class="variants" aria-label="äºˆæ¸¬90æ—¥è²©å£²æ•°ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰">
                  <div class="vrow" data-scn="risk" data-active="false"><div class="k">ãƒªã‚¹ã‚¯é‡è¦–ğŸ€</div><div class="v" id="pred90Risk">â€”</div></div>
                  <div class="vrow" data-scn="profit" data-active="true"><div class="k">åˆ©ç›Šãƒ™ãƒ¼ã‚¹âœ¨</div><div class="v" id="pred90Profit">â€”</div></div>
                  <div class="vrow" data-scn="attack" data-active="false"><div class="k">æ”»ã‚ğŸ”¥</div><div class="v" id="pred90Attack">â€”</div></div>
                </div>
              </div>

              <!-- äºˆæ¸¬30æ—¥ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ -->
              <div class="m-input">
                <div class="label">äºˆæ¸¬30æ—¥è²©å£²æ•°</div>
                <div class="variants" aria-label="äºˆæ¸¬30æ—¥è²©å£²æ•°ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰">
                  <div class="vrow" data-scn="risk" data-active="false"><div class="k">ãƒªã‚¹ã‚¯é‡è¦–ğŸ€</div><div class="v" id="pred30Risk">â€”</div></div>
                  <div class="vrow" data-scn="profit" data-active="true"><div class="k">åˆ©ç›Šãƒ™ãƒ¼ã‚¹âœ¨</div><div class="v" id="pred30Profit">â€”</div></div>
                  <div class="vrow" data-scn="attack" data-active="false"><div class="k">æ”»ã‚ğŸ”¥</div><div class="v" id="pred30Attack">â€”</div></div>
                </div>
              </div>
            </div>
          </div>

          

<!-- 2è¡Œç›®ï¼ˆå®Ÿç¸¾ï¼‰ -->
          <div class="metrics-row row2">
            <div class="metric-grid">
              <div class="metric">
                <div class="label">180æ—¥è²©å£²æ•°ï¼ˆå®Ÿç¸¾ï¼‰</div>
                <div class="value" id="act180">510</div>
              </div>
              <div class="metric">
                <div class="label">90æ—¥è²©å£²æ•°ï¼ˆå®Ÿç¸¾ï¼‰</div>
                <div class="value" id="act90">260</div>
              </div>
              <div class="metric">
                <div class="label">30æ—¥è²©å£²æ•°ï¼ˆå®Ÿç¸¾ï¼‰</div>
                <div class="value" id="act30">95</div>
              </div>
            </div>
          </div>

          

<!-- 3è¡Œç›®ï¼ˆFBA/åœ¨åº«ãªã©ï¼‰ -->
          <div class="metrics-row row3">
            <div class="metric-grid" style="margin-top:10px;">
              <div class="metric">
                <div class="label">åœ¨åº«æ•°</div>
                <div class="value" id="invQty">342</div>
              </div>
              <div class="metric">
                <div class="label">è²©å£²ä¾¡æ ¼ï¼ˆ$ï¼‰</div>
                <div class="value" id="fbaLow">$39.99</div>
              </div>
              <div class="metric">
                <div class="label">å‡ºå“ã‚»ãƒ©ãƒ¼æ•°ï¼ˆFBAï¼‰</div>
                <div class="value" id="fbaSellers">12</div>
              </div>
            </div>
          </div>

          <div class="bottom-pills">
            <div class="pillbox">
              <div class="l">è²©å£²ä¾¡æ ¼ï¼ˆ$ï¼‰</div>
              <div class="r">$39.99</div>
            </div>
            <div class="pillbox">
              <div class="l">ç²—åˆ©ç›Š</div>
              <div class="r">Â¥2,498 <span class="subtle">(40.3%)</span></div>
            </div>
          </div>
        </section>
      </div>

      <!-- LOWER ROW -->
      <div class="lower">
        <section class="card-ui">
          <h4>keepaã‚°ãƒ©ãƒ•</h4>
          <div class="placeholder">ï¼ˆã‚°ãƒ©ãƒ•ç”»åƒ / iframeæƒ³å®šï¼‰</div>
        </section>

        <section class="card-ui demand-card">
          <h4>éœ€è¦ä¾›çµ¦ã‚°ãƒ©ãƒ•ï¼ˆ180æ—¥ï¼‰</h4>

          <div class="chart-wrap">
            <div class="chart-head">
              <div class="title">éœ€è¦ä¾›çµ¦ã‚°ãƒ©ãƒ•ï¼ˆ180æ—¥ï¼‰</div>
              <div class="toggles">
                <label><input type="checkbox" checked /> éœ€è¦&amp;ä¾›çµ¦</label>
                <label><input type="checkbox" /> ä¾›çµ¦&amp;ä¾¡æ ¼</label>
              </div>
            </div>

            <div class="fake-graph" aria-label="ã‚°ãƒ©ãƒ•ã®è¦‹ãŸç›®ã‚’å†ç¾ã—ãŸãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼">
              <div class="fake-line"></div>
            </div>

            <div class="legend">
              <span><i class="dot" style="background:rgba(59,130,246,.9)"></i>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</span>
              <span><i class="dot" style="background:rgba(245,158,11,.9)"></i>ã‚»ãƒ©ãƒ¼æ•°</span>
              <span><i class="dot" style="background:rgba(16,185,129,.9)"></i>ä¾¡æ ¼(USD)</span>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- RIGHT -->
    <aside class="side" aria-label="ã‚«ãƒ¼ãƒˆ">
      <div class="side-body">

        <!-- ä¸Šä½3ã‚·ãƒ§ãƒƒãƒ— -->
        <div class="top3-wrap" aria-label="ä¸Šä½3ã‚·ãƒ§ãƒƒãƒ—">
          <div class="top3-head">
            <div class="top3-title">ä¸Šä½3ã‚·ãƒ§ãƒƒãƒ—ï¼ˆä¾¡æ ¼ã®å®‰ã„é †ï¼‰</div>
          </div>
          <div class="top3-list" id="top3List"></div>

          <button class="morebtn morebtn-wide" id="openModalBtn" type="button">å…¨ã‚·ãƒ§ãƒƒãƒ—ã‚’è¦‹ã‚‹</button>

          <div class="manual-wrap" aria-label="ãã®ä»–ï¼ˆæ‰‹å‹•å…¥åŠ›ï¼‰">
            <div class="manual-title">ãã®ä»–ï¼ˆæ‰‹å‹•å…¥åŠ›ï¼‰</div>
            <div class="row shop-other manual-row">
              <div class="left">
                <div class="rank">ï¼‹</div>
                <div class="shopname">ãã®ä»–</div>
              </div>
              <div class="price manual-price">
                <span class="yenmark">Â¥</span>
                <input id="manualPrice" type="number" inputmode="numeric" min="0" placeholder="ä¾¡æ ¼" />
              </div>
              <div class="right" id="manualStepperHost"></div>
            </div>
          </div>

          <div class="hinttxt" style="margin:8px 2px 0;">â€»ã“ã“ã§ã‚‚æ•°é‡ã‚’ï¼‹/âˆ’ã§å¤‰æ›´ã§ãã¾ã™</div>
        </div>

        <!-- ASINé›†è¨ˆ -->
        <div class="summary-box" aria-label="ASINé›†è¨ˆ">
          <div class="summary-head">
            <div class="summary-title">ASINé›†è¨ˆ</div>
            <div class="hinttxt" style="margin:0; opacity:.65; font-weight:1000; font-size:10px;">
              â€»è²©å£²é¡/å…¥é‡‘/ç²—åˆ©ç›Šã¯ä»®è¨ˆç®—
            </div>
          </div>

          <div class="summary-grid">
            <div class="sum-row"><div class="k">åˆè¨ˆä»•å…¥ã‚Œå€‹æ•°</div><div class="v" id="sumQty">â€”</div></div>
            <div class="sum-row"><div class="k">ä»•å…¥ã‚Œå¹³å‡é¡</div><div class="v" id="sumAvg">â€”</div></div>
            <div class="sum-row"><div class="k">ä»•å…¥ã‚Œé¡åˆè¨ˆ</div><div class="v" id="sumBuyTotal">â€”</div></div>
            <div class="sum-row"><div class="k">è²©å£²é¡åˆè¨ˆ</div><div class="v" id="sumSalesTotal">â€”</div></div>
            <div class="sum-row"><div class="k">å…¥é‡‘é¡åˆè¨ˆ</div><div class="v" id="sumPayoutTotal">â€”</div></div>
            <div class="sum-row"><div class="k">ç²—åˆ©ç›Šé¡åˆè¨ˆï¼ˆç²—åˆ©ç›Šç‡ï¼‰</div><div class="v" id="sumProfit">â€”</div></div>
          </div>
        </div>

        <div class="dash"></div>

        <div class="actions">
          <button class="btn" type="button">å¾Œã§ï¼ˆä»•å…¥ã‚Œãƒªã‚¹ãƒˆä»®ç™»éŒ²ï¼‰</button>
          <button class="btn primary" type="button">ä»•å…¥ã‚ŒãŸï¼ˆä»•å…¥ã‚Œãƒªã‚¹ãƒˆç™»éŒ²ï¼‰</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="å„ã‚·ãƒ§ãƒƒãƒ—ã®ä¾¡æ ¼">
    <div class="modal">
      <button class="close" id="closeBtn" type="button">Ã—</button>
      <h3>ã‚·ãƒ§ãƒƒãƒ—åˆ¥ã®ä¾¡æ ¼ï¼ˆä¾¡æ ¼ã®å®‰ã„é †ï¼‰</h3>
      <div class="modal-list" id="modalList"></div>
      <div class="okwrap"><button class="ok" id="okBtn" type="button">OK</button></div>
      <div class="hinttxt" style="margin:0 8px 2px;">â€»ã“ã®ç”»é¢ã§ã‚‚æ•°é‡ã‚’ï¼‹/âˆ’ã§å¤‰æ›´ã§ãã¾ã™</div>
    </div>
  </div>

  <script>
    // ====== ä»®è¨ˆç®—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨ï¼‰ ======
    const FX_RATE_JPY_PER_USD = 150;
    const SELL_PRICE_USD = 39.99;
    const PAYOUT_RATE = 0.85;

    const shopData = [
      { shop: "Amazon", slug:"amazon", includeInShopList: true, offers: [
        { id: "amz-1", price: 3980, stock: 9,  qty: 0, manual:false },
        { id: "amz-2", price: 4200, stock: 3,  qty: 0, manual:false },
      ]},
      { shop: "æ¥½å¤©", slug:"rakuten", includeInShopList: true, offers: [
        { id: "rkt-1", price: 4150, stock: 5,  qty: 0, manual:false },
      ]},
      { shop: "Yahoo", slug:"yahoo", includeInShopList: true, offers: [
        { id: "yah-1", price: 4090, stock: 12, qty: 0, manual:false },
      ]},
      { shop: "ãã®ä»–", slug:"other", includeInShopList: false, offers: [] },
    ];


    // æ‰‹å‹•å…¥åŠ›ï¼ˆãã®ä»–ï¼‰
    const MANUAL_OFFER_ID = "manual-1";
    const otherShop = shopData.find(s => s.slug === "other");
    if (otherShop && !otherShop.offers.some(o => o.id === MANUAL_OFFER_ID)){
      otherShop.offers.push({ id: MANUAL_OFFER_ID, price: 0, stock: null, qty: 0, manual: true });
    }

    function renderManual(){
      const host = document.getElementById("manualStepperHost");
      const priceEl = document.getElementById("manualPrice");
      if (!host || !priceEl) return;

      const found = findOfferById(MANUAL_OFFER_ID);
      if (!found) return;

      // price input
      const curPrice = Number(found.offer.price) || 0;
      if (document.activeElement !== priceEl){
        priceEl.value = curPrice > 0 ? String(curPrice) : "";
      }

      // stepper
      host.innerHTML = "";
      const st = renderStepper(found.offer.qty,
        ()=>{ incQty(MANUAL_OFFER_ID, -1); renderAll(false); },
        ()=>{ incQty(MANUAL_OFFER_ID, +1); renderAll(false); }
      );
      st.style.width = "104px";
      host.appendChild(st);

      // bind input once
      if (!priceEl.dataset.bound){
        priceEl.addEventListener("input", () => {
          const v = Number(priceEl.value);
          found.offer.price = (Number.isFinite(v) && v > 0) ? Math.round(v) : 0;
          renderSummary();
        });
        priceEl.dataset.bound = "1";
      }
    }


    const yen = (n) => (Number.isFinite(n) ? "Â¥" + n.toLocaleString("ja-JP") : "Â¥â€”");

    function escapeHTML(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function shopClass(slug){ return "shop-" + slug; }
    function sortOffersByPrice(s){ s.offers.sort((a,b) => (a.price||0) - (b.price||0)); }

    function findOfferById(id){
      for (const s of shopData){
        const o = s.offers.find(x => x.id === id);
        if (o) return {shop:s, offer:o};
      }
      return null;
    }
    function setQty(id, nextQty){
      const found = findOfferById(id);
      if (!found) return;
      found.offer.qty = Math.max(0, Math.min(999, nextQty));
    }
    function incQty(id, delta){
      const found = findOfferById(id);
      if (!found) return;
      setQty(id, (Number(found.offer.qty)||0) + delta);
    }

    function renderStepper(qty, onMinus, onPlus){
      const wrap = document.createElement("div");
      wrap.className = "stepper";
      wrap.innerHTML = `
        <div class="label">æ•°é‡</div>
        <div class="controls">
          <button class="qbtn" type="button" data-minus>âˆ’</button>
          <div class="qval" data-val>${qty}</div>
          <button class="qbtn" type="button" data-plus>ï¼‹</button>
        </div>
      `;
      wrap.querySelector("[data-minus]").addEventListener("click", onMinus);
      wrap.querySelector("[data-plus]").addEventListener("click", onPlus);
      return wrap;
    }

    function flattenShopOffersSorted(){
      const items = [];
      shopData.filter(s => s.includeInShopList).forEach(s => {
        s.offers.forEach(o => items.push({ shop:s, offer:o }));
      });
      items.sort((a,b) => (a.offer.price||0) - (b.offer.price||0));
      return items;
    }

    function renderTop3(){
      const list = document.getElementById("top3List");
      list.innerHTML = "";

      const items = flattenShopOffersSorted();
      const top3 = items.slice(0, 3);

      if (top3.length === 0){
        const empty = document.createElement("div");
        empty.className = "row dim";
        empty.innerHTML = `
          <div class="left">
            <div class="rank">â€”</div>
            <div class="shopname">â€”</div>
          </div>
          <div class="price">Â¥â€”</div>
          <div class="right"></div>
        `;
        const st = renderStepper("", ()=>{}, ()=>{});
        st.style.opacity = ".55";
        st.querySelector("[data-minus]").disabled = true;
        st.querySelector("[data-plus]").disabled = true;
        empty.querySelector(".right").appendChild(st);
        list.appendChild(empty);
      } else {
        top3.forEach(({shop, offer}, i) => {
          const r = document.createElement("div");
          r.className = `row ${shopClass(shop.slug)}`;
          r.innerHTML = `
            <div class="left">
              <div class="rank">${i+1}</div>
              <div class="shopname">${escapeHTML(shop.shop)}</div>
            </div>
            <div class="price">${yen(offer.price)}</div>
            <div class="right"></div>
          `;
          const st = renderStepper(offer.qty,
            ()=>{ incQty(offer.id, -1); renderAll(false); },
            ()=>{ incQty(offer.id, +1); renderAll(false); }
          );
          r.querySelector(".right").appendChild(st);
          list.appendChild(r);
        });
      }

      document.getElementById("openModalBtn").disabled = items.length === 0;
    }
    function computeStats(){
      let buyTotal = 0;
      let qtyTotal = 0;
      shopData.forEach(s => s.offers.forEach(o => {
        const q = Number(o.qty)||0;
        const p = Number(o.price)||0;
        if (q>0 && p>0){
          buyTotal += p*q;
          qtyTotal += q;
        }
      }));

      const avg = qtyTotal>0 ? Math.round(buyTotal/qtyTotal) : null;

      const sellJpyPerUnit = Math.round(SELL_PRICE_USD * FX_RATE_JPY_PER_USD);
      const salesTotal = qtyTotal>0 ? sellJpyPerUnit * qtyTotal : null;
      const payoutTotal = salesTotal ? Math.round(salesTotal * PAYOUT_RATE) : null;

      const profit = (payoutTotal!=null) ? (payoutTotal - buyTotal) : null;
      const margin = (payoutTotal && payoutTotal>0 && profit!=null) ? (profit / payoutTotal) : null;

      return { qtyTotal, avg, buyTotal: qtyTotal>0 ? buyTotal : null, salesTotal, payoutTotal, profit, margin };
    }
    function renderSummary(){
      const s = computeStats();
      document.getElementById("sumQty").textContent = s.qtyTotal ? s.qtyTotal.toLocaleString("ja-JP") : "â€”";
      document.getElementById("sumAvg").textContent = s.avg!=null ? yen(s.avg) : "â€”";
      document.getElementById("sumBuyTotal").textContent = s.buyTotal!=null ? yen(s.buyTotal) : "â€”";
      document.getElementById("sumSalesTotal").textContent = s.salesTotal!=null ? yen(s.salesTotal) : "â€”";
      document.getElementById("sumPayoutTotal").textContent = s.payoutTotal!=null ? yen(s.payoutTotal) : "â€”";
      if (s.profit==null){
        document.getElementById("sumProfit").textContent = "â€”";
      } else {
        const pct = (s.margin!=null) ? ` (${(s.margin*100).toFixed(1)}%)` : "";
        document.getElementById("sumProfit").textContent = `${yen(s.profit)}${pct}`;
      }
    }

    function clampInt(v, min, max){
      const n = Math.floor(Number(v));
      if (!Number.isFinite(n)) return min;
      return Math.min(max, Math.max(min, n));
    }

    // äºˆæ¸¬å€¤ï¼šact30 ã‚’åŸºæº–ã«ã€æ—¥æ•°Ã—ä¿‚æ•°ã§ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œã‚‹
    function computePredBase(days){
      const act30 = Number(document.getElementById("act30")?.textContent) || 0;
      const perDay = act30 / 30;
      return Math.round(perDay * days);
    }
    function predVariants(base){
      // â€»ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨ï¼šä¿‚æ•°ã¯ã“ã“ã§èª¿æ•´ã§ãã¾ã™
      return {
        risk:  Math.max(0, Math.round(base * 0.85)),
        profit:Math.max(0, Math.round(base * 1.00)),
        attack:Math.max(0, Math.round(base * 1.20)),
      };
    }

    let ACTIVE_SCENARIO = "profit"; // æ¨™æº–

    function setGauge(elId, numId, stateId, value){
      const g = document.getElementById(elId);
      const n = document.getElementById(numId);
      const s = document.getElementById(stateId);
      if(!g || !n || !s) return;
      const v = Math.max(0, Math.min(100, Number(value)||0));
      g.style.setProperty('--p', v);
      n.textContent = String(v);

      // çŠ¶æ…‹ï¼šã‚·ãƒ³ãƒ—ãƒ«ã«2æ®µéšï¼ˆæ³¨æ„/å®‰å®šï¼‰
      let st = 'stable';
      let label = 'å®‰å®š';
      if(v >= 50){ st='warn'; label='æ³¨æ„'; }
      if(v >= 70){ st='danger'; label='æ³¨æ„'; }
      g.dataset.state = st;
      s.textContent = label;
    }

    function initGauges(){
      // ã²ã¨ã¾ãšãƒ€ãƒŸãƒ¼å€¤ï¼ˆå¾Œã§å®Ÿãƒ­ã‚¸ãƒƒã‚¯ã«å·®ã—æ›¿ãˆOKï¼‰
      setGauge('g_recent','g_recent_num','g_recent_state', 62);
      setGauge('g_count','g_count_num','g_count_state', 38);
      setGauge('g_both','g_both_num','g_both_state', 54);
    }

    function setScenario(next){
      ACTIVE_SCENARIO = next;

      // ä¸Šã®ãƒã‚§ãƒƒã‚¯ï¼ˆè¦‹ãŸç›®ï¼‰
      [
        {id:"opt-risk", val:"risk"},
        {id:"opt-profit", val:"profit"},
        {id:"opt-attack", val:"attack"},
      ].forEach(x => {
        const el = document.getElementById(x.id);
        if (!el) return;
        el.setAttribute("data-active", String(x.val === ACTIVE_SCENARIO));
      });

      // å„æ ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      document.querySelectorAll(".vrow").forEach(r => {
        const scn = r.getAttribute("data-scn");
        r.setAttribute("data-active", String(scn === ACTIVE_SCENARIO));
      });

      // å³ä¸Šã®è¡¨ç¤ºï¼ˆäºˆæ¸¬ã€‡æ—¥ï¼‰ã‚‚é¸æŠä¸­ã®å€¤ã«åˆã‚ã›ã‚‹
      renderPrediction();
    }

    function renderPrediction(){
      const daysEl = document.getElementById("predDays");
      if (!daysEl) return;

      const days = clampInt(daysEl.value, 1, 999);
      daysEl.value = String(days);

      // ã€‡æ—¥
      const baseAny = computePredBase(days);
      const any = predVariants(baseAny);
      document.getElementById("predVarRisk").textContent = String(any.risk);
      document.getElementById("predVarProfit").textContent = String(any.profit);
      document.getElementById("predVarAttack").textContent = String(any.attack);

      // 90æ—¥
      const base90 = computePredBase(90);
      const v90 = predVariants(base90);
      document.getElementById("pred90Risk").textContent = String(v90.risk);
      document.getElementById("pred90Profit").textContent = String(v90.profit);
      document.getElementById("pred90Attack").textContent = String(v90.attack);

      // 30æ—¥
      const base30 = computePredBase(30);
      const v30 = predVariants(base30);
      document.getElementById("pred30Risk").textContent = String(v30.risk);
      document.getElementById("pred30Profit").textContent = String(v30.profit);
      document.getElementById("pred30Attack").textContent = String(v30.attack);

      // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ç¢ºå®Ÿã«åæ˜ 
      document.querySelectorAll(".vrow").forEach(r => {
        const scn = r.getAttribute("data-scn");
        r.setAttribute("data-active", String(scn === ACTIVE_SCENARIO));
      });
    }


    /* Modal */
    const overlay = document.getElementById("overlay");
    const openModalBtn = document.getElementById("openModalBtn");
    const closeBtn = document.getElementById("closeBtn");
    const okBtn = document.getElementById("okBtn");

    function renderModal(){
      const list = document.getElementById("modalList");
      list.innerHTML = "";
      const items = flattenShopOffersSorted();

      if (items.length === 0){
        const card = document.createElement("div");
        card.className = "card shop-other";
        card.innerHTML = `
          <div class="card-head"><div>è¡¨ç¤ºã§ãã‚‹ã‚·ãƒ§ãƒƒãƒ—ãŒã‚ã‚Šã¾ã›ã‚“</div><div>&nbsp;</div></div>
          <div class="meta">
            <div class="pill"><span>ä¾¡æ ¼</span><span style="font-weight:1000;">Â¥â€”</span></div>
            <div class="pill"><span>æ•°é‡</span><span style="font-weight:1000;">â€”</span></div>
          </div>`;
        list.appendChild(card);
        return;
      }

      items.forEach(({shop, offer}, idx) => {
        const card = document.createElement("div");
        card.className = `card ${shopClass(shop.slug)}`;
        card.innerHTML = `
          <div class="card-head">
            <div>${idx+1}. ã‚·ãƒ§ãƒƒãƒ—åï¼š${escapeHTML(shop.shop)}</div>
            <div style="font-size:10px; font-weight:1000; opacity:.86;">&nbsp;</div>
          </div>
          <div class="meta">
            <div class="pill"><span>ä¾¡æ ¼</span><span style="font-weight:1000;">${yen(offer.price)}</span></div>
            <div class="pill" data-stepper-host></div>
          </div>`;
        const host = card.querySelector("[data-stepper-host]");
        const st = renderStepper(offer.qty,
          ()=>{ incQty(offer.id, -1); refreshModalOnly(); },
          ()=>{ incQty(offer.id, +1); refreshModalOnly(); }
        );
        st.style.minWidth = "100%";
        st.style.maxWidth = "100%";
        host.appendChild(st);
        list.appendChild(card);
      });
    }

    function openModal(){
      if (flattenShopOffersSorted().length === 0) return;
      renderModal();
      overlay.classList.add("open");
    }
    function closeModal(){ overlay.classList.remove("open"); }
    function refreshModalOnly(){
      if (overlay.classList.contains("open")) renderModal();
      renderAll(false);
    }

    openModalBtn.addEventListener("click", openModal);
    closeBtn.addEventListener("click", closeModal);
    okBtn.addEventListener("click", () => { renderAll(); closeModal(); });
    overlay.addEventListener("click", (e) => { if (e.target === overlay) closeModal(); });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && overlay.classList.contains("open")) closeModal();
    });

    document.getElementById("predDays")?.addEventListener("input", renderPrediction);

    // ã‚·ãƒŠãƒªã‚ªåˆ‡æ›¿ï¼ˆãƒã‚§ãƒƒã‚¯ã—ãŸã‚‚ã®ãŒç›®ç«‹ã¤ï¼‰
    document.querySelectorAll('input[name="scenario"]').forEach(r => {
      r.addEventListener('change', (e) => setScenario(e.target.value));
    });


    function renderAll(rerenderModalToo=true){
      shopData.forEach(sortOffersByPrice);
      renderTop3();
      renderSummary();
      renderPrediction();
      renderManual(); // åˆå›ã‚‚ç¢ºå®Ÿã«åæ˜ 
      if (rerenderModalToo && overlay.classList.contains("open")) renderModal();
    }
    // DOMæç”»å¾Œã«1å›å¼·åˆ¶åæ˜ 
    initGauges();
    renderAll();
    setScenario('profit');
    requestAnimationFrame(renderPrediction);
  </script>
</body>
</html>
